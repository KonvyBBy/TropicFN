<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Konvy Accounts - Premium Fortnite Marketplace</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='dashboard.css') }}">
</head>

<body>
  <!-- Modern Navigation Header -->
  <header class="modern-header">
    <div class="header-container">
      <div class="header-left">
        <div class="logo-modern">
          <span class="logo-icon">K</span>
          <span class="logo-text">Konvy</span>
        </div>
      </div>
      
      <nav class="header-nav">
        <a href="#search" class="nav-link active" data-scroll="search">Search</a>
        {% if logged_in %}
          <a href="#balance" class="nav-link" data-scroll="balance">Balance</a>
          <a href="#my-accounts" class="nav-link" data-scroll="my-accounts">My Accounts</a>
          <a href="#redeem" class="nav-link" data-scroll="redeem">Redeem</a>
        {% endif %}
        <a href="{{ url_for('warranty') }}" class="nav-link">Warranty</a>
      </nav>
      
      <div class="header-right">
        {% if logged_in %}
          <div class="user-badge">
            <span class="user-icon">üë§</span>
            <span class="user-name">{{ username }}</span>
          </div>
          <div class="balance-badge">${{ balance }}</div>
          <a href="{{ url_for('logout') }}" class="btn-logout">Logout</a>
        {% else %}
          <a href="{{ url_for('login') }}" class="btn-secondary-header">Login</a>
          <a href="{{ url_for('register') }}" class="btn-primary-header">Sign Up</a>
        {% endif %}
      </div>
    </div>
  </header>

  <!-- Main Content Wrapper -->
  <div class="content-wrapper">
    <main class="main-content">

      <!-- Hero Section -->
      <section class="hero-section" id="home">
        <div class="hero-content">
          {% if logged_in %}
            <h1 class="hero-title">Welcome back, <span class="highlight">{{ username }}</span></h1>
            <p class="hero-subtitle">Manage your Fortnite accounts and explore new opportunities</p>
            
            <div class="stats-grid">
              <div class="stat-card">
                <div class="stat-icon">üí∞</div>
                <div class="stat-info">
                  <div class="stat-label">Balance</div>
                  <div class="stat-value">${{ balance }}</div>
                </div>
              </div>
              
              <div class="stat-card">
                <div class="stat-icon">üéÆ</div>
                <div class="stat-info">
                  <div class="stat-label">Accounts Owned</div>
                  <div class="stat-value">{{ purchases|length }}</div>
                </div>
              </div>
              
              <div class="stat-card">
                <div class="stat-icon">‚úÖ</div>
                <div class="stat-info">
                  <div class="stat-label">Account Status</div>
                  <div class="stat-value">Active</div>
                </div>
              </div>
              
              <div class="stat-card">
                <div class="stat-icon">‚≠ê</div>
                <div class="stat-info">
                  <div class="stat-label">Membership</div>
                  <div class="stat-value">Standard</div>
                </div>
              </div>
            </div>
          {% else %}
            <h1 class="hero-title">Find Your Perfect <span class="highlight">Fortnite Account</span></h1>
            <p class="hero-subtitle">Browse thousands of premium accounts with rare skins, high levels, and exclusive cosmetics</p>
            
            <div class="hero-actions">
              <a href="{{ url_for('register') }}" class="btn-hero-primary">Get Started</a>
              <a href="#search" class="btn-hero-secondary" data-scroll="search">Browse Accounts</a>
            </div>
            
            <div class="features-grid">
              <div class="feature-item">
                <div class="feature-icon">‚ö°</div>
                <div class="feature-text">Instant Delivery</div>
              </div>
              <div class="feature-item">
                <div class="feature-icon">üîí</div>
                <div class="feature-text">Secure Transactions</div>
              </div>
              <div class="feature-item">
                <div class="feature-icon">üé≠</div>
                <div class="feature-text">Rare Skins & Items</div>
              </div>
              <div class="feature-item">
                <div class="feature-icon">‚ú®</div>
                <div class="feature-text">Full Access Accounts</div>
              </div>
            </div>
          {% endif %}
        </div>
      </section>

      <!-- Search Section -->
      <section class="content-section" id="search">
        <div class="section-header">
          <h2 class="section-title">Search Accounts</h2>
          <p class="section-description">Find accounts with your favorite skins and cosmetics</p>
        </div>
        
        <div class="search-container">
          <form id="search-form" class="modern-form">
            <!-- Search Items -->
            <div class="form-group">
              <label class="form-label">Search Items <span class="label-required">*</span></label>
              <p class="form-hint">Enter skins, emotes, or other cosmetics you're looking for</p>
              <div id="items-container">
                <div class="item-input-row">
                  <div class="autocomplete-wrapper">
                    <input 
                      type="text" 
                      class="form-input item-search-input" 
                      placeholder="e.g., Black Knight, Floss, Reaper Pickaxe..." 
                      autocomplete="off">
                    <div class="autocomplete-dropdown"></div>
                  </div>
                  <button type="button" class="btn-icon-remove remove-item-btn" style="display:none;">
                    <span>‚úï</span>
                  </button>
                </div>
              </div>
              <button type="button" id="add-item-btn" class="btn-link">+ Add Another Item</button>
            </div>

            <!-- Filter Grid -->
            <div class="filters-grid">
              <div class="form-group">
                <label class="form-label">Maximum Budget</label>
                <div class="input-with-icon">
                  <span class="input-icon">$</span>
                  <input 
                    id="budget-input"
                    name="budget" 
                    type="number" 
                    class="form-input" 
                    placeholder="Enter max price" 
                    min="0"
                    step="1">
                </div>
                <p class="form-hint">Leave blank for no limit</p>
              </div>

              <div class="form-group">
                <label class="form-label">Days Offline</label>
                <input name="days" type="number" placeholder="0 = any" min="0" value="0" class="form-input">
                <p class="form-hint">Minimum days since last played</p>
              </div>

              <div class="form-group">
                <label class="form-label">Minimum Skins</label>
                <input name="skins" type="number" placeholder="0 = any" min="0" value="0" class="form-input">
                <p class="form-hint">Total number of skins required</p>
              </div>
            </div>

            <button type="submit" class="btn-search">
              <span class="btn-icon">üîç</span>
              <span>Search Accounts</span>
            </button>
          </form>

          <!-- Results -->
          <div id="search-results-wrapper">
            <div id="search-results" class="accounts-grid"></div>
          </div>
        </div>
      </section>

      {% if logged_in %}
      <!-- Balance Section -->
      <section class="content-section" id="balance">
        <div class="section-header">
          <h2 class="section-title">Manage Balance</h2>
          <p class="section-description">Check your balance and add funds to your account</p>
        </div>

        <div class="balance-grid">
          <div class="balance-card">
            <div class="card-icon">üí∞</div>
            <h3 class="card-title">Check Balance</h3>
            <p class="card-description">View your current account balance</p>
            <button id="check-balance-btn" class="btn-card-action">Check Balance</button>
            <div id="balance-result" class="result-display"></div>
          </div>

          <div class="balance-card">
            <div class="card-icon">üí≥</div>
            <h3 class="card-title">Add Funds</h3>
            <p class="card-description">Generate a secure payment link to add funds</p>
            <div class="form-group">
              <label class="form-label">Amount (USD)</label>
              <div class="input-with-icon">
                <span class="input-icon">$</span>
                <input id="topup-amount" type="number" step="0.01" value="10" class="form-input" placeholder="10.00">
              </div>
            </div>
            <button id="topup-btn" class="btn-card-action">Generate Link</button>
            <div id="topup-result" class="result-display"></div>
          </div>
        </div>

        <div class="info-banner">
          <div class="info-icon">üí°</div>
          <div class="info-content">
            <strong>How it works:</strong> Generate a payment link, complete the transaction on Shopify, then use the Redeem section with your order number to add funds to your account.
          </div>
        </div>
      </section>

      <!-- My Accounts Section -->
      <section class="content-section" id="my-accounts">
        <div class="section-header">
          <h2 class="section-title">My Accounts</h2>
          <p class="section-description">View and manage your purchased Fortnite accounts</p>
        </div>

        <div class="account-viewer">
          <div id="my-accounts-view" class="account-details"></div>

          <div class="account-navigation">
            <button id="prev-account" class="btn-nav-account">‚Üê Previous</button>
            <span id="account-indicator" class="account-counter"></span>
            <button id="next-account" class="btn-nav-account">Next ‚Üí</button>
          </div>
        </div>

        {% if purchases|length > 0 %}
        <div class="security-notice">
          <div class="notice-header">
            <span class="notice-icon">üîí</span>
            <h3>Security Reminder</h3>
          </div>
          <p>Remember to secure your account following our <a href="https://youtu.be/ykQsz5QrZkg" target="_blank">warranty guide</a> to maintain eligibility for warranty claims.</p>
        </div>
        {% endif %}
      </section>

      <!-- Redeem Section -->
      <section class="content-section" id="redeem">
        <div class="section-header">
          <h2 class="section-title">Redeem Order</h2>
          <p class="section-description">Convert your Shopify order into account balance</p>
        </div>

        <div class="redeem-card">
          <div class="card-icon">üéüÔ∏è</div>
          
          <div class="steps-list">
            <div class="step-item">
              <span class="step-number">1</span>
              <span class="step-text">Generate payment link in the Balance section</span>
            </div>
            <div class="step-item">
              <span class="step-number">2</span>
              <span class="step-text">Complete payment on Shopify</span>
            </div>
            <div class="step-item">
              <span class="step-number">3</span>
              <span class="step-text">Find your order number (e.g., 1234)</span>
            </div>
            <div class="step-item">
              <span class="step-number">4</span>
              <span class="step-text">Enter below and redeem to add funds</span>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">Order Number</label>
            <input id="redeem-order" type="number" class="form-input" placeholder="Enter order number without #">
          </div>

          <button id="redeem-btn" class="btn-redeem">üéüÔ∏è Redeem Order</button>
          <div id="redeem-result" class="result-display"></div>
        </div>
      </section>
      {% endif %}

    </main>
  </div>

  <!-- Modals -->
  <div id="skins-modal" class="skins-modal">
    <div class="skins-modal-content">
      <div class="skins-modal-header">
        <h2>Account Preview</h2>
        <button class="modal-close-btn" onclick="closeSkinsModal()">‚úï</button>
      </div>
      <div id="skins-grid" class="skins-grid"></div>
      <div id="skins-loader" class="skins-loader">
        <div class="loader-spinner"></div>
        <div class="loader-text">Loading Preview...</div>
        <div class="loader-progress">
          <span id="skins-loaded">0</span> / <span id="skins-total">0</span>
        </div>
        <div class="loader-count">Loading cosmetics in optimized batches</div>
      </div>
    </div>
  </div>

<script>
  window.KONVY_LOGGED_IN = {{ 'true' if logged_in else 'false' }};
</script>
<script src="{{ url_for('static', filename='dashboard.js') }}"></script>
</body>
</html>
